#!/bin/sh

case `uname -s` in
	FreeBSD)
		jls | grep -v 'JID.*IP Address.*Hostname.*Path' | awk '{print $2,$3}' | while read line ; do
			if [ "x" != "x${line}" ]; then
				search=$( echo "${line}" | awk '{print $2}' )
				if [ "x" = "x${search}" ]; then
					echo "${line}"
				else
					zfslist=$( zfs list -H -o name,used tank/iocage/jails/${search} 2> /dev/null )
					#zfslist=$( grep tank/ezjail/${search} /server/zfs/zl.txt )
					if [ "x" = "x${zfslist}" ]; then
						echo "${line}"
					else
						used=$( echo "${zfslist}" | awk '{print $2}' )
						echo "${line} ${used}"
					fi
				fi
			fi
		done | sort | column -t
	;;
esac
